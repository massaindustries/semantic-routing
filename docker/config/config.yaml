# config.yaml - vLLM Semantic Router per Regolo routing
version: "1.0"

# ============================================================
# PROVIDERS CONFIGURATION (backend endpoints)
# ============================================================
providers:
  models:
    - name: "Qwen3-8B"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "Qwen3-8B"
      
    - name: "gpt-oss-20b"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "gpt-oss-20b"
      
    - name: "gpt-oss-120b"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "gpt-oss-120b"
      reasoning_family: "qwen3"
      
    - name: "deepseek-r1-70b"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "deepseek-r1-70b"
      reasoning_family: "deepseek"
      
    - name: "qwen3-coder-next"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "qwen3-coder-next"
      
    - name: "Llama-3.3-70b-Instruct"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "Llama-3.3-70b-Instruct"
      
    - name: "mistral-small-3.2"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "mistral-small-3.2"
      
    - name: "gemma-3-27b-it"
      endpoints:
        - name: "regolo"
          endpoint: "127.0.0.1:8888"
          protocol: "http"
          weight: 1
      model_id: "gemma-3-27b-it"
  
  default_model: "gpt-oss-120b"

# ============================================================
# LISTENERS CONFIGURATION
# ============================================================
listeners:
  - name: "default"
    address: "0.0.0.0"
    port: 8888

# ============================================================
# CLASSIFIER CONFIGURATION
# ============================================================
classifier:
  category_model:
    model_id: "models/mom-domain-classifier"
    threshold: 0.6
    use_cpu: true
    category_mapping_path: "models/mom-domain-classifier/category_mapping.json"

# ============================================================
# SIGNALS CONFIGURATION
# ============================================================
signals:
  keywords:
    - name: "greeting_keywords"
      operator: "OR"
      keywords:
        - "ciao"
        - "come stai"
        - "grazie"
        - "ok"
        - "va bene"
      case_sensitive: false
    
    - name: "easy_keywords"
      operator: "OR"
      keywords:
        - "quanto è"
        - "cos'è"
        - "chi è"
        - "dove è"
        - "quando è"
        - "cosa è"
        - "come si fa"
        - "spiega"
        - "racconta"
      case_sensitive: false
    
    - name: "creative_keywords"
      operator: "OR"
      keywords:
        - "racconta"
        - "storia"
        - "scrivi un racconto"
        - "narrativa"
        - "personaggio"
        - "trama"
        - "creative writing"
        - "poesia"
        - "dialogo"
        - "sceneggiatura"
        - "fanta"
      case_sensitive: false
    
    - name: "code_keywords"
      operator: "OR"
      keywords:
        - "codice"
        - "programma"
        - "funzione"
        - "script"
        - "debug"
        - "implementa"
        - "python"
        - "javascript"
        - "java"
        - "c++"
        - "refactor"
        - "API"
        - "algoritmo"
        - "class"
        - "metodo"
        - "reag"
        - "vue"
        - "svelte"
      case_sensitive: false
    
    - name: "medium_keywords"
      operator: "OR"
      keywords:
        - "analizza"
        - "confronta"
        - "valuta"
        - "differenza tra"
        - "spiega"
        - "opinione"
        - "consiglio"
        - "aiuto"
      case_sensitive: false
    
    - name: "complex_keywords"
      operator: "OR"
      keywords:
        - "dimostra"
        - "prova che"
        - "deduzione"
        - "ragiona"
        - "calcola"
        - "risolvi"
        - "derivata"
        - "integrale"
        - "equazione"
        - "sistema"
        - "dimostri"
        - "teorema"
        - "lemm"
      case_sensitive: false
    
    - name: "expert_keywords"
      operator: "OR"
      keywords:
        - "dimostra"
        - "prova che"
        - "deduzione"
        - "reasoning"
        - "chain of thought"
        - "step by step"
        - "pensa profondamente"
        - "teoria"
        - "ipotesi"
        - "congettura"
        - "demo"
      case_sensitive: false

# ============================================================
# REASONING FAMILIES
# ============================================================
reasoning_families:
  deepseek:
    type: "chat_template_kwargs"
    parameter: "thinking"
  qwen3:
    type: "chat_template_kwargs"
    parameter: "enable_thinking"

# ============================================================
# DEFAULT REASONING EFFORT
# ============================================================
default_reasoning_effort: "medium"

# ============================================================
# CATEGORIES
# ============================================================
categories:
  - name: "business"
    description: "Business and management"
    mmlu_categories: ["business"]
  - name: "computer_science"
    description: "Computer science and programming"
    mmlu_categories: ["computer_science"]
  - name: "math"
    description: "Mathematics"
    mmlu_categories: ["math"]
  - name: "humanities"
    description: "Humanities and arts"
    mmlu_categories: ["humanities"]
  - name: "other"
    description: "General knowledge"
    mmlu_categories: ["other"]

# ============================================================
# DECISIONS
# ============================================================
strategy: "priority"

decisions:
  - name: "simple-chat"
    description: "Query semplici"
    priority: 100
    rules:
      operator: "OR"
      conditions:
        - type: "keyword"
          name: "greeting_keywords"
        - type: "keyword"
          name: "easy_keywords"
    modelRefs:
      - model: "Qwen3-8B"
        use_reasoning: false
    
  - name: "easy-questions"
    description: "Domande semplici"
    priority: 90
    rules:
      operator: "OR"
      conditions:
        - type: "keyword"
          name: "easy_keywords"
        - type: "domain"
          name: "other"
    modelRefs:
      - model: "Qwen3-8B"
        use_reasoning: false
    
  - name: "storytelling-creative"
    description: "Creative writing"
    priority: 85
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "humanities"
        - type: "keyword"
          name: "creative_keywords"
    modelRefs:
      - model: "Llama-3.3-70b-Instruct"
        use_reasoning: false
    
  - name: "coding-tasks"
    description: "Programming"
    priority: 80
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "computer_science"
        - type: "keyword"
          name: "code_keywords"
    modelRefs:
      - model: "qwen3-coder-next"
        use_reasoning: false
    
  - name: "medium-complexity"
    description: "Query medie"
    priority: 70
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "business"
        - type: "keyword"
          name: "medium_keywords"
    modelRefs:
      - model: "gpt-oss-20b"
        use_reasoning: false
    
  - name: "complex-reasoning"
    description: "Query complesse"
    priority: 50
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "math"
        - type: "domain"
          name: "computer_science"
        - type: "keyword"
          name: "complex_keywords"
    modelRefs:
      - model: "gpt-oss-120b"
        use_reasoning: true
    
  - name: "expert-reasoning"
    description: "Reasoning profondo"
    priority: 40
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "math"
        - type: "keyword"
          name: "expert_keywords"
    modelRefs:
      - model: "deepseek-r1-70b"
        use_reasoning: true
    
  - name: "default-fallback"
    description: "Fallback"
    priority: 1
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "other"
    modelRefs:
      - model: "gpt-oss-20b"
        use_reasoning: false
